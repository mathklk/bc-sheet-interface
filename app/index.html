<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuVoWerk</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script type="importmap">
        {
            "imports": {
                "@material/web/": "https://esm.run/@material/web/"
            }
        }
    </script>
    <script type="module">
        import '@material/web/textfield/outlined-text-field.js';
    </script>
    
    <!-- Google API JavaScript client -->
    <script src="https://apis.google.com/js/api.js" onload="gapiLoadCallback()"></script>
    <script src="https://accounts.google.com/gsi/client" onload="gisLoadCallback()"></script>
</head>
<body>
    <!-- Auth Modal -->
    <div id="authModal" class="md3-scrim">
        <div class="md3-dialog">
            <div class="md3-dialog-header">
                <span class="material-icons-round md3-dialog-icon">login</span>
                <h2 class="md3-dialog-headline">Anmeldung erforderlich</h2>
            </div>
            
            <div class="md3-dialog-content">
                <div class="md3-text-field-container">
                    <div id="authMessage" style="text-align: center; padding: 20px;">
                        <!-- <div class="md3-circular-progress" style="width: 24px; height: 24px; margin: 0 auto 10px;">
                            <svg viewBox="0 0 48 48">
                                <circle cx="24" cy="24" r="18" fill="none" stroke-width="4"/>
                            </svg>
                        </div>
                        <h3 style="margin-bottom: 16px; font-weight: 500; color: var(--md-sys-color-on-surface);">Verbinde mit Google</h3> -->
                        <p style="color: #c0c0c0; margin-bottom: 20px;">Um BuVoWerk zu nutzen, musst du dich mit deinem Google-Konto anmelden.</p>
                        <button id="signInBtn" class="md3-button md3-button-filled">
                            <span class="material-icons-round">account_circle</span>
                            <span>Mit Google anmelden</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration Modal -->
    <div id="configModal" class="md3-scrim">
        <div class="md3-dialog">
            <div class="md3-dialog-header">
                <button id="closeConfigBtn" class="md3-icon-button">
                    <span class="material-icons-round">close</span>
                </button>
                <span class="material-icons-round md3-dialog-icon">settings</span>
                <h2 class="md3-dialog-headline">Einladung erstellen</h2>
            </div>
            
            <div class="md3-dialog-content">
                <div class="md3-text-field-container">
                    <p style="margin-bottom: 20px;">Du bist noch keiner Gruppe beigetreten. Nutze zum Beitreten einen <b>Einladungslink</b>, oder erstelle selbst einen.</p>
                    
                    <md-outlined-text-field 
                        id="configSheetUrl" 
                        label="Google Sheet URL" 
                        placeholder="https://docs.google.com/spreadsheets/d/..."
                        class="md3-text-field-full-width">
                        <span slot="leading-icon" class="material-icons-round">link</span>
                    </md-outlined-text-field>
                    
                    <md-outlined-text-field 
                        id="configSheetName" 
                        label="Sheet Name" 
                        placeholder="Tabelle1"
                        class="md3-text-field-full-width">
                        <span slot="leading-icon" class="material-icons-round">table_chart</span>
                    </md-outlined-text-field>
                    
                    <md-outlined-text-field 
                        id="configClientId" 
                        label="OAuth Client ID" 
                        placeholder="...apps.googleusercontent.com"
                        class="md3-text-field-full-width">
                        <span slot="leading-icon" class="material-icons-round">key</span>
                    </md-outlined-text-field>
                    
                    <div id="inviteLink" style="margin-top: 20px; display: none;">
                        <p style="margin-bottom: 10px;">Dein Einladungslink:</p>
                        <div class="md3-text-field-container">
                            <md-outlined-text-field 
                                id="generatedLink" 
                                readonly
                                class="md3-text-field-full-width">
                                <button slot="trailing-icon" class="md3-icon-button" onclick="copyInviteLink()">
                                    <span class="material-icons-round">content_copy</span>
                                </button>
                            </md-outlined-text-field>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="md3-dialog-actions">
                <button id="generateLinkBtn" class="md3-button md3-button-filled">
                    <span>Link generieren</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Name Setup Modal -->
    <div id="nameModal" class="md3-scrim">
        <div class="md3-dialog">
            <div class="md3-dialog-header">
                <span class="material-icons-round md3-dialog-icon">book</span>
                <h2 class="md3-dialog-headline">Willkommen bei BuVoWerk</h2>
            </div>
            
            <div class="md3-dialog-content">
                <div class="md3-text-field-container">
                    <div id="loadingNames" style="display: none; text-align: center; padding: 20px;">
                        <div class="md3-circular-progress" style="width: 24px; height: 24px; margin: 0 auto 10px;">
                            <svg viewBox="0 0 48 48">
                                <circle cx="24" cy="24" r="18" fill="none" stroke-width="4"/>
                            </svg>
                        </div>
                        <p>Lade verfügbare Namen...</p>
                    </div>
                    
                    <div id="nameSelectionContainer" style="display: none;">
                        <h3 style="text-align: center; margin-bottom: 20px; font-weight: 500; color: var(--md-sys-color-on-surface);">Wer bist du?</h3>
                        
                        <div id="nameButtonGrid" class="name-button-grid">
                            <!-- Name buttons will be populated here -->
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <small style="color: #666;">Wenn dein Name hier fehlt, trage einen Vorschlag manuell über die BWT ein.</small>
                        </div>
                    </div>
                    
                    <div id="nameError" style="display: none; color: #d32f2f; text-align: center; padding: 16px;">
                        <p>Namen konnten nicht geladen werden. Bitte versuche es erneut oder kontaktiere den Administrator.</p>
                    </div>
                </div>
            </div>
            
            <div class="md3-dialog-actions">
                <!-- Removed viewer mode button -->
            </div>
        </div>
    </div>

    <!-- Edit Book Modal -->
    <div id="editModal" class="md3-scrim">
        <div class="md3-dialog md3-dialog-fullscreen">
            <div class="md3-dialog-header">
                <button id="cancelEditBtn" class="md3-icon-button">
                    <span class="material-icons-round">close</span>
                </button>
                <h2 class="md3-dialog-headline">Buch bearbeiten</h2>
                <button id="saveEditBtn" class="md3-button md3-button-text">
                    <span class="material-icons-round">save</span>
                    <span>Speichern</span>
                </button>
            </div>
            
            <div class="md3-dialog-content">
                <div class="md3-form-grid">
                    <div class="md3-form-row">
                        <md-outlined-text-field 
                            id="editBookTitle" 
                            label="Titel" 
                            required
                            class="md3-field-title">
                        </md-outlined-text-field>
                        
                        <md-outlined-text-field 
                            id="editBookAuthor" 
                            label="Autor" 
                            required
                            class="md3-field-author">
                        </md-outlined-text-field>
                    </div>
                    
                    <div class="md3-form-row">
                        <md-outlined-text-field 
                            id="editBookGenre" 
                            label="Genre"
                            class="md3-field-genre-wide">
                        </md-outlined-text-field>
                        
                        <md-outlined-text-field 
                            id="editBookYear" 
                            label="Jahr"
                            min="1800" 
                            max="2030"
                            class="md3-field-year">
                        </md-outlined-text-field>
                        
                        <md-outlined-text-field 
                            id="editBookPages" 
                            label="Seitenzahl"
                            min="1"
                            class="md3-field-pages">
                        </md-outlined-text-field>
                    </div>
                    
                    <md-outlined-text-field 
                        id="editBookDescription" 
                        label="Beschreibung"
                        type="textarea" 
                        rows="3"
                        class="md3-text-field-full-width">
                    </md-outlined-text-field>
                </div>
                
                <div class="md3-dialog-actions md3-dialog-actions-bottom">
                    <button id="deleteBookBtn" class="md3-button md3-button-text md3-button-error">
                        <span class="material-icons-round">delete</span>
                        <span>Löschen</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="md3-surface">
        <!-- Top App Bar -->
        <header class="md3-top-app-bar">
            <div class="md3-top-app-bar-content">
                <span class="material-icons-round md3-top-app-bar-leading-icon">book</span>
                <h1 class="md3-top-app-bar-headline">BuVoWerk - Buch-Vorschlags Werkzeug</h1>
                <div class="md3-top-app-bar-actions">
                    <button id="addBookModalBtn" class="md3-button md3-button-filled">
                        <span class="material-icons-round">add_circle</span>
                        <span>Buch vorschlagen</span>
                    </button>
                    <button id="votingModeBtn" class="md3-button md3-button-outlined">
                        <span class="material-icons-round">how_to_vote</span>
                        <span>Abstimmungsmodus</span>
                    </button>
                </div>
                <div class="md3-top-app-bar-trailing" id="userInfo">
                    <span class="md3-top-app-bar-user-text">Hallo, <strong id="currentUser"></strong>!</span>
                    <button id="logoutBtn" class="md3-icon-button" title="Ausloggen">
                        <span class="material-icons-round">logout</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="md3-main-content">
            <!-- Books List Section -->
            <section class="md3-books-section">
                <div class="md3-section-header">
                    <div class="md3-section-header-top">
                        <h2 class="md3-section-headline">Buchvorschläge</h2>
                        
                        <div class="md3-section-actions">
                            <div class="md3-voting-info" id="votingInfo" style="display: none;">
                                <div class="md3-voting-counter">
                                    <span class="material-icons-round">how_to_vote</span>
                                    <span id="votingText">Stimmen: <span id="votesRemaining">3</span> verbleibend</span>
                                </div>
                                <div class="md3-ready-toggle" id="readyToggle" style="display: none;">
                                    <label class="md3-switch">
                                        <input type="checkbox" id="readyCheckbox" disabled>
                                        <span class="md3-switch-track">
                                            <span class="md3-switch-thumb"></span>
                                        </span>
                                        <span class="md3-switch-label">Bereit</span>
                                    </label>
                                </div>
                            </div>
                            <button id="refreshBtn" class="md3-icon-button" title="Aktualisieren">
                                <span class="material-icons-round">refresh</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filter Tabs -->
                    <div class="md3-tabs" id="filterTabs">
                        <!-- Tabs will be dynamically generated by updateTabsWithUsers() -->
                    </div>
                </div>
                
                <div id="booksList" class="md3-books-grid">
                    <!-- Books will be loaded here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Add Book Modal -->
    <div id="addBookModal" class="md3-scrim">
        <div class="md3-dialog md3-dialog-add-book">
            <div class="md3-dialog-header">
                <span class="material-icons-round md3-dialog-icon">edit_note</span>
                <h2 class="md3-dialog-headline">Neuer Buchvorschlag </h2>
            </div>
            
            <div class="md3-dialog-content">
                <form class="md3-add-book-form" id="addBookForm">
                    <div class="md3-form-row md3-form-row-primary">
                        <md-outlined-text-field 
                            id="bookTitle" 
                            label="Buchtitel" 
                            required
                            class="md3-field-title-primary">
                            <span slot="leading-icon" class="material-icons-round">menu_book</span>
                        </md-outlined-text-field>
                        
                        <md-outlined-text-field 
                            id="bookAuthor" 
                            label="Autor/in" 
                            required
                            class="md3-field-author-primary">
                            <span slot="leading-icon" class="material-icons-round">person</span>
                        </md-outlined-text-field>
                    </div>

                    <div class="md3-form-row md3-form-row-details">
                        <md-outlined-text-field 
                            id="bookGenre" 
                            label="Genre" 
                            class="md3-field-genre-enhanced">
                            <span slot="leading-icon" class="material-icons-round">category</span>
                        </md-outlined-text-field>
                        
                        <md-outlined-text-field 
                            id="bookYear" 
                            label="Jahr"
                            min="1800" 
                            max="2030"
                            class="md3-field-year-enhanced">
                            <span slot="leading-icon" class="material-icons-round">calendar_today</span>
                        </md-outlined-text-field>
                        
                        <md-outlined-text-field 
                            id="bookPages" 
                            label="Seitenzahl"
                            min="1"
                            class="md3-field-pages-enhanced">
                            <span slot="leading-icon" class="material-icons-round">description</span>
                        </md-outlined-text-field>
                    </div>

                    <md-outlined-text-field 
                        id="bookDescription" 
                        label="Kurzbeschreibung"
                        type="textarea" 
                        rows="4"
                        class="md3-field-description-enhanced"
                        maxlength="1000">
                        <span slot="leading-icon" class="material-icons-round">rate_review</span>
                    </md-outlined-text-field>
                </form>
            </div>
            
            <div class="md3-dialog-actions">
                <button type="button" id="clearFormBtn" class="md3-button md3-button-outlined">
                    <span class="material-icons-round">clear</span>
                    <span>Zurücksetzen</span>
                </button>
                <button type="submit" form="addBookForm" id="submitBookBtn" class="md3-button md3-button-filled">
                    <span class="material-icons-round">add_circle</span>
                    <span>Vorschlag einreichen</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Book Detail Modal -->
    <div id="bookDetailModal" class="md3-scrim">
        <!-- Content will be dynamically populated -->
    </div>

    <!-- Loading indicator -->
    <div id="loadingIndicator" class="md3-circular-progress-container">
        <div class="md3-circular-progress">
            <svg viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="18" fill="none" stroke-width="4"/>
            </svg>
        </div>
        <p class="md3-loading-text">Lädt...</p>
    </div>

    <script src="app.js"></script>
</body>
</html>
